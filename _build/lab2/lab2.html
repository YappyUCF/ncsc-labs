
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AHV Networking</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Generic AHV/ESX and CVM Commands Reference" href="../appendix/all_host_ssh.html" />
    <link rel="prev" title="Access Remote Console to System using IPMI and using the Crash Cart Tool" href="../lab1/lab1.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<link href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  </head><body>

  <div id="navbar" class="navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/NutanixWorkshops.svg"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html"> <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Lab 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html">Access Remote Console to System using IPMI and using the Crash Cart Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#using-the-crashcart-network-configuration-command">Using the Crashcart network_configuration Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#running-foundation-from-a-cvm">Running Foundation from a CVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#click-upgrade-from-version-of-aos">1-Click Upgrade from version of AOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#install-foundation-vm-on-your-laptop-optional-reference-lab">Install Foundation VM on your laptop (optional reference lab)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#install-prism-central">Install Prism Central</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#create-an-as-built-guide">Create an As Built Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Lab 2</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">AHV Networking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#changing-network-bond-modes-in-ahv">Changing Network Bond modes in AHV</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-bond-from-active-backup-to-balance-slb">Changing Bond from Active/backup to balance-slb</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/all_host_ssh.html">Generic AHV/ESX and CVM Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/glossary.html">Glossary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix/glossary.html#nutanix-core">Nutanix Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#aos">AOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#pulse">Pulse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#prism-element">Prism Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#prism-central">Prism Central</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#node">Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#block">Block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#storage-pool">Storage Pool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#storage-container">Storage Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#anatomy-of-a-read-i-o">Anatomy of a Read I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#anatomy-of-a-write-i-o">Anatomy of a Write I/O</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/glossary.html#nutanix-karbon">Nutanix Karbon</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><p class="caption"><span class="caption-text">Lab 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html">Access Remote Console to System using IPMI and using the Crash Cart Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#using-the-crashcart-network-configuration-command">Using the Crashcart network_configuration Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#running-foundation-from-a-cvm">Running Foundation from a CVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#click-upgrade-from-version-of-aos">1-Click Upgrade from version of AOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#install-foundation-vm-on-your-laptop-optional-reference-lab">Install Foundation VM on your laptop (optional reference lab)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#install-prism-central">Install Prism Central</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/lab1.html#create-an-as-built-guide">Create an As Built Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Lab 2</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">AHV Networking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#changing-network-bond-modes-in-ahv">Changing Network Bond modes in AHV</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-bond-from-active-backup-to-balance-slb">Changing Bond from Active/backup to balance-slb</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/all_host_ssh.html">Generic AHV/ESX and CVM Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="ahv-networking">
<span id="lab2"></span><h1>AHV Networking<a class="headerlink" href="#ahv-networking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="changing-network-bond-modes-in-ahv">
<h2>Changing Network Bond modes in AHV<a class="headerlink" href="#changing-network-bond-modes-in-ahv" title="Permalink to this headline">¶</a></h2>
<p>In this lab we would like to show you what it takes to set your bonds from the default active-backup to balance-slb (active/passive to active/active)</p>
<div class="figure">
<img alt="../_images/ncsc-4.png" src="../_images/ncsc-4.png" />
</div>
</div>
<div class="section" id="changing-bond-from-active-backup-to-balance-slb">
<h2>Changing Bond from Active/backup to balance-slb<a class="headerlink" href="#changing-bond-from-active-backup-to-balance-slb" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">ssh into one of your CVMs</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh nutanix@CVM-IP
</pre></div>
</div>
</li>
<li><p class="first">To show the bond mode of the host run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh root@192.168.5.1 <span class="s2">&quot;ovs-appctl bond/show br0-up&quot;</span>
</pre></div>
</div>
<p>Notice the bond_mode should default to active-backup</p>
</li>
<li><p class="first">Change the bond mode to balance-slb run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh root@192.168.5.1 <span class="s2">&quot;ovs-vsctl set port br0-up bond_mode=balance-slb&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Set the recommended rebalance-interval to 30 sec with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh root@192.168.5.1 <span class="s2">&quot;ovs-vsctl set port br0-up other_config:bond-rebalance-interval=30000&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify the proper bond mode again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh root@192.168.5.1 <span class="s2">&quot;ovs-appctl bond/show br0-up&quot;</span>
</pre></div>
</div>
<p>Notice the next rebalance should be less than 30000ms bond_mode should be balance-slb</p>
</li>
<li><p class="first">Repeat steps 1-5 for the remaining CVMs in order to change all ports modes to balance-slb</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><p>You can set the network mode on all AHV hosts from a single CVM using the <code class="docutils literal notranslate"><span class="pre">hostssh</span></code> command (note that the cluster services need to running for this command to work)</p>
</div></blockquote>
<p>Test usage of <code class="docutils literal notranslate"><span class="pre">hostssh</span></code> command</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>hostssh &lt;<span class="nb">command</span> to run on AHV host&gt;

hostssh uname -a  <span class="c1">#this will return the OS version on all AHV hosts</span>

<span class="c1">#the command output will look as follows:</span>

<span class="c1"># ============= 10.42.8.27 ============</span>
<span class="c1"># Linux PHX-POC008-3 4.4.77-1.el6.nutanix.20170830.301.x86_64 #1 SMP Wed Jun 26 17:05:47 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="c1"># ============= 10.42.8.25 ============</span>
<span class="c1"># Linux PHX-POC008-1 4.4.77-1.el6.nutanix.20170830.301.x86_64 #1 SMP Wed Jun 26 17:05:47 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="c1"># ============= 10.42.8.28 ============</span>
<span class="c1"># Linux PHX-POC008-4 4.4.77-1.el6.nutanix.20170830.301.x86_64 #1 SMP Wed Jun 26 17:05:47 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="c1"># ============= 10.42.8.26 ============</span>
<span class="c1"># Linux PHX-POC008-2 4.4.77-1.el6.nutanix.20170830.301.x86_64 #1 SMP Wed Jun 26 17:05:47 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>

hostssh ovs-appctl bond/show br0-up
<span class="c1"># ============= 10.42.8.27 ============ &lt;&lt; 1/4 AHV node</span>
<span class="c1"># ---- br0-up ----</span>
<span class="c1"># bond_mode: active-backup</span>
<span class="c1"># bond may use recirculation: no, Recirc-ID : -1</span>
<span class="c1"># bond-hash-basis: 0</span>
<span class="c1"># updelay: 0 ms</span>
<span class="c1"># downdelay: 0 ms</span>
<span class="c1"># lacp_status: off</span>
<span class="c1"># active slave mac: 0c:c4:7a:59:cf:cf(eth3)</span>
<span class="c1">#</span>
<span class="c1"># slave eth0: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth1: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth2: enabled</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># slave eth3: enabled</span>
<span class="c1">#         active slave</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># ============= 10.42.8.25 ============ &lt;&lt; 2/4 AHV node</span>
<span class="c1"># ---- br0-up ----</span>
<span class="c1"># bond_mode: active-backup</span>
<span class="c1"># bond may use recirculation: no, Recirc-ID : -1</span>
<span class="c1"># bond-hash-basis: 0</span>
<span class="c1"># updelay: 0 ms</span>
<span class="c1"># downdelay: 0 ms</span>
<span class="c1"># lacp_status: off</span>
<span class="c1"># active slave mac: 0c:c4:7a:59:d1:fd(eth3)</span>
<span class="c1">#</span>
<span class="c1"># slave eth0: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth1: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth2: enabled</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># slave eth3: enabled</span>
<span class="c1">#         active slave</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># ============= 10.42.8.28 ============ &lt;&lt; 3/4 AHV node</span>
<span class="c1"># ---- br0-up ----</span>
<span class="c1"># bond_mode: active-backup</span>
<span class="c1"># bond may use recirculation: no, Recirc-ID : -1</span>
<span class="c1"># bond-hash-basis: 0</span>
<span class="c1"># updelay: 0 ms</span>
<span class="c1"># downdelay: 0 ms</span>
<span class="c1"># lacp_status: off</span>
<span class="c1"># active slave mac: 0c:c4:7a:59:d3:7d(eth3)</span>
<span class="c1">#</span>
<span class="c1"># slave eth0: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth1: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth2: enabled</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># slave eth3: enabled</span>
<span class="c1">#         active slave</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># ============= 10.42.8.26 ============ &lt;&lt; 4/4 AHV node</span>
<span class="c1"># ---- br0-up ----</span>
<span class="c1"># bond_mode: active-backup</span>
<span class="c1"># bond may use recirculation: no, Recirc-ID : -1</span>
<span class="c1"># bond-hash-basis: 0</span>
<span class="c1"># updelay: 0 ms</span>
<span class="c1"># downdelay: 0 ms</span>
<span class="c1"># lacp_status: off</span>
<span class="c1"># active slave mac: 0c:c4:7a:59:d3:7f(eth3)</span>
<span class="c1">#</span>
<span class="c1"># slave eth0: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth1: disabled</span>
<span class="c1">#         may_enable: false</span>
<span class="c1">#</span>
<span class="c1"># slave eth2: enabled</span>
<span class="c1">#         may_enable: true</span>
<span class="c1">#</span>
<span class="c1"># slave eth3: enabled</span>
<span class="c1">#         active slave</span>
<span class="c1">#         may_enable: true</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/lab2/lab2.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2019 Nutanix.<br/>
    </p>
  </div>
</footer>
  </body>
</html>